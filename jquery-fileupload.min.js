/**
 * fileUpload
 * http://abandon.ie
 *
 * Plugin to add file uploads to jQuery ajax form submit
 * 
 * November 2013
 * 
 * @version 0.9
 * @author Abban Dunne http://abandon.ie
 * @license MIT
 * 
 */(function(e,t,n,r){function o(t,n){this.element=t;this.$form=e(t);this.$uploaders=e("input[type=file]",this.element);this.files={},this.settings=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="fileUpload",s={uploadData:{},submitData:{},uploadOptions:{},submitOptions:{},before:function(){},success:function(){},error:function(){},complete:function(){}};o.prototype={init:function(){this.$uploaders.on("change",{context:this},this.processFiles);this.$form.on("submit",{context:this},this.uploadFiles)},processFiles:function(t){var n=t.data.context;n.files[e(t.target).attr("name")]=t.target.files},uploadFiles:function(t){t.stopPropagation();t.preventDefault();var n=t.data.context;n.settings.before();var r=new FormData;r.append("file_upload_incoming","1");e.each(n.files,function(t,n){e.each(n,function(e,t){r.append(e,t)})});e.each(n.settings.uploadData,function(e,t){r.append(e,t)});e.ajax(e.extend({},{url:n.$form.attr("action"),type:"POST",data:r,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(e,r,i){n.processSubmit(t,e)},error:function(e,t,r){n.settings.error(e,t,r)}},n.settings.uploadOptions))},processSubmit:function(t,n){var r=t.data.context;r.settings.beforeSubmit(n);var i=r.$form.serializeArray();e.each(n,function(e,t){i.push({name:e,value:t})});e.each(r.settings.submitData,function(e,t){i.push({name:e,value:t})});e.ajax(e.extend({},{url:r.$form.attr("action"),type:"POST",data:i,cache:!1,dataType:"json",success:function(e,t,n){r.settings.success(e,t,n)},error:function(e,t,n){r.settings.error(e,t,n)},complete:function(e,t){r.settings.complete(e,t)}},r.settings.submitOptions))}};e.fn[i]=function(t){return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new o(this,t))})}})(jQuery,window,document);